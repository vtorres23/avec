{% extends 'avec/base_dashboard.html' %}
{% load staticfiles %}
{% block content %}
<!doctype html>
<html class="no-js" lang="">
  <head>
	<meta charset="utf-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<title>AVEC - Ciencia de dados</title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	  <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' />		

	<link href='https://fonts.googleapis.com/css?family=Lato:400,300,700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="{% static 'css/normalize.css' %}">
	<link rel="stylesheet" href="{% static 'css/main.css' %}">
	
	<link rel="stylesheet" href="{% static 'css/font-awesome.min.css' %}">
	<link rel="stylesheet" href="{% static 'css/owl.carousel.css' %}">
	<link rel="stylesheet" href="{% static 'css/responsive.css' %}">
	<link rel="stylesheet" href="{% static 'css/style.css' %}">
	<link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
	<link rel="stylesheet" href="{% static 'css/keen-dashboards.css' %}" />
	<link rel="stylesheet" href="{% static 'css/dc.css' %}" />
    <link rel="stylesheet" href="{% static 'css/dataTables.bootstrap.css' %}"/>	  	
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
   <!-- <link href="css/style2.css" rel="stylesheet">-->
   
    <script type="text/javascript" src="{% static 'js/jquery.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/jquery-1.9.1.min.js' %}"></script>	
   
	<script type="text/javascript" src="{% static 'js/jquery.dataTables.js' %}"></script>	
    <script src="{% static 'js/colorbrewer.js' %}"></script>
	
    <script src="{% static 'js/bootstrap.min.js' %}"></script>
	<script type="text/javascript" src="{% static 'js/d3.js' %}"></script>
	<script type="text/javascript" src="{% static 'js/crossfilter.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/dc.js' %}"></script>		
	<script type="text/javascript" src="{% static 'js/dataTables.bootstrap.js' %}"></script>
	<script src="{% static 'js/cloud.js' %}"></script>
   <!--<script type="text/javascript" src="http://www.kunalbabre.com/projects/table2CSV.js" > </script> 	-->

	<!--  <link href='css/bootstrap.min.css' rel='stylesheet' type='text/css'>-->
	<link rel="stylesheet" href="{% static 'css/dc.css' %}" />
	
	<script>
		var indice = "{% static 'data/indice.csv' %}";
		var world_countries = "{% static 'data/worldcountries.json' %}";
		var inpi_personalidade = "{% static 'data/inpi_2016_personalidade.csv' %}";		
		
	</script>
	
	<style>
input[type=text] {
    width: 130px;
    box-sizing: border-box;
    border: 1.5px solid #ccc;
    border-radius: 2px;
    font-size: 16px;
    background-color: white;
    background-image: url('search.png');
    background-position: 10px 10px; 
    background-repeat: no-repeat;
    padding: 12px 20px 12px 40px;
    -webkit-transition: width 0.4s ease-in-out;
    transition: width 0.4s ease-in-out;
}

input[type=text]:focus {
    width: 100%;
}
	
    div.tooltip  { color: #222; background: #fff; padding: .5em; text-shadow: #f5f5f5 0 1px 0;
                   border-radius: 2px; box-shadow: 0px 0px 2px 0px #a6a6a6; opacity: 0.9; position: absolute; }
    div.tooltip .sep { color: #444; font-weight: 300; }
    path.country { fill: #e7eaef; stroke: none; }
    text.legend  { fill: #242930; }
	
	
	#chart-06,  #chart-07,  #chart-08,  #chart-09{
        background: #899296;
        width: 100%;
        font-size: 64px;
        text-align: center;
        padding-top: 10px;
        padding-bottom: 100px;
        height: 40px;
        line-height: normal;
		margin-bottom: 15px;
      }
	
    #labelchart01{
		text-align: center;
		font-size: 1em;
	}
	#labelchart0{
		text-align: left;
		font-size: 1em;
		padding-left : 15px;
	}
	#labelchart02, #labelchart03, #labelchart04{
		text-align: center;
		font-size: 0.9em;
	}
	
	#brancaChart,  #pretaChart,  #amarelaChart,  #indigenaChart,  #pardaChart, #chart15 , #chart16, #chart17, #chart18, #chart19, #chart20
	, #chart21, #chart22, #chart23, #chart24, #chart25, #chart26{
        background: #e2e2e2;
        width: 100%;
        font-size: 12x;
        text-align: center;
		padding-left: 2px;
        padding-top: 2px;
        padding-bottom: 5px;
        height: 20px;
        line-height: normal;
		margin-bottom: 2px;
		padding: center;
      }
	  
	  	#svg-map path { fill:#d3d3d3 }
		#svg-map text { fill:#fff; font:12px Arial-BoldMT, sans-serif; cursor:pointer }
		#svg-map a{ text-decoration:none }
		#svg-map a:hover { cursor:pointer; text-decoration:none }
		#svg-map a:hover path{ fill:#b7c3c8 !important }
		#svg-map .circle { fill:#899296 }
		#svg-map a:hover .circle { fill:#b7c3c8 !important; cursor:pointer }
		
		@import url(/style.css);

#chart {
  margin-left: -40px;
  height: 506px;
}

text {
  font: 10px sans-serif;
}

.dot {
  stroke: #000;
}

.axis path, .axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.label {
  fill: #777;
}

.year.label {
  font: 500 110px "Helvetica Neue";
  fill: #ddd;
}

.year.label.active {
  fill: #aaa;
}

.overlay {
  fill: none;
  pointer-events: all;
  cursor: ew-resize;
}


/* Paste this css to your style sheet file or under head tag */
/* This only works with JavaScript, 
if it's not present, don't show loader */
.no-js #loader { display: none;  }
.js #loader { display: block; position: absolute; left: 100px; top: 0; }
.se-pre-con {
	position: fixed;
	left: 0px;
	top: 0px;
	width: 100%;
	height: 100%;
	z-index: 9999;
	background: url(../img/load_avec.gif) center no-repeat #fff;
}


    svg {
      font: 18px sans-serif;
    }

    #chart {
      width: 960px;
      height: 500px;
      background: #ddd;
    }

    text {
      pointer-events: none;
    }

    .grandparent text {
      font-weight: bold;
      fill: white;
	  font-size: 100%;
    }

    #rect {
      fill: none;
      stroke: #fff;
    }

    #rect.parent,
    .grandparent rect {
      stroke-width: 2px;
    }

    .grandparent rect {
      fill: slategray;
    }

    .grandparent:hover rect {
      fill: #ee9700;
    }

    .children #rect.parent,
    .grandparent #rect {
      cursor: pointer;
    }

    .children #rect.parent {
      fill: #bbb;
      fill-opacity: .5;
    }

    .children:hover rect.child {
      fill: #bbb;
	  
    }
	</style>
<script>
//paste this code under the head tag or in a separate js file.
	// Wait for window load
	$(window).load(function() {
		// Animate loader off screen
		$(".se-pre-con").fadeOut("slow");;
	});</script>
  </head>
  <body ng-app="app">
<div class="se-pre-con"></div>
  
  
<div id="content">
	<div class="title_sec" style="    padding-top: 20px;">
				<h1>Inovação</h1>
				<h2>estatisticas e informacoes sobre indices globais</h2>
	</div>
<div class="container-fluid">
    <div class="row">
		<div class="col-sm-10">
		
			<div class="row">
			  <div class="col-sm-12">
				<div class="chart-wrapper">
				  <h1 id="labelchart0">Indice Global de Inovação - Posição do Brasil no ranking mundial</h1>				  
				</div>
			  </div>
			</div>				
			
			<div class="row">
			  <div class="col-sm-3">
				<div class="chart-wrapper">
				  <h1 id="labelchart01">2013</h1>
				  <div id="chart-06">64º</div>
				</div>
			  </div>
			  <div class="col-sm-3">
				<div class="chart-wrapper">
				   	<h1 id="labelchart01">2014</h1>
				   <div id="chart-07">61º</div>
				</div>
			  </div>
			  <div class="col-sm-3">
				<div class="chart-wrapper">
					<h1 id="labelchart01">2015</h1>
				   <div id="chart-08">70º</div>
				</div>
			  </div>
			  <div class="col-sm-3">
				<div class="chart-wrapper">
					<h1 id="labelchart01">2016</h1>
				   <div id="chart-09">69º</div>
				</div>
			  </div>
			</div>
			<div class="row">

<!--
			  <div class="col-sm-3">
				<div class="chart-wrapper">
				  <div class="chart-title" id="mapa">
					us-chart
				  </div>
				  <div class="chart-stage">
					<div id="us-chart">
						<div class="clearfix"></div>
					</div>
				  </div>
				  <div class="chart-notes">
					fonte: 
				  </div>
				</div>
			  </div>
	-->		  
			  <div class="col-sm-8">
				<div class="chart-wrapper">
				  <div class="chart-title" id="treemapbox">
					INPI - Depositos por UF e tipo de proteção
				  </div>
					<div ng-controller="treemapCtrl" id="treemap">

					<div class="form-horizontal">

					  <form class="form-group" style=" padding-top: 12px;">

						<label for="year-select" class="col-sm-2 control-label">Escolha o ano:</label>
						<div class="col-sm-2">
						  <select ng-model="year" id="year-select" class="form-control">
							<option value="2016">2016</option>
							<option value="2015">2015</option>
						  </select>
						</div>

					  </form>

					</div>

					<treemap></treemap>

					</div>
				  <div class="chart-notes">
					fonte: INPI
				  </div>
				</div>
			  </div>
			  
			  <div class="col-sm-4">
				<div class="chart-wrapper">
				  <div class="chart-title"  id="mapa2">
					INPI - Depósitos por assunto
				  </div>
				  <div class="chart-stage">
						<div id="chart-01"></div>
				  </div>
				  <div class="chart-notes">
					fonte: INPI
				  </div>
				</div>
			  </div>

			  
			</div>  
			
			<div class="row">

			  

			  <div class="col-sm-6">
				<div class="chart-wrapper">
				  <div class="chart-title">
					INPI - Patentes por origem do depositante
				  </div>
				  <div class="chart-stage" id="chart-stage04">
					<div id="chart-04"></div>
				  </div>
				  <div class="chart-notes">
					fonte: 
				  </div>
				</div>
			  </div>
			  
			  <div class="col-sm-6">
				<div class="chart-wrapper" width="100%">
				  <div class="chart-title">
					INPI - Patentes por origem do depositante natureza jurídica
				  </div>
				  <div class="chart-stage" id="bigchart-05">
		
		 <!-- <center> -->
        <!-- <div class="col-md-6 col-md-offset-1"> -->
		
				        <table class='table table-hover' id='chart-05' class="list table table-striped table-bordered" width="100%">
							 
								<thead>
									<tr class='header' center style="background-color: Cornsilk ;">
										<th> Origem</th>
										<th> Personalidade</th>
										<th> Tipo</th>
										<th> Patente de Invenção</th>
										<th> Modelo de Utilidade</th>
										<th> Certificado de adição</th>
										<th> Total Geral</th>
										
									 </tr>
								</thead>
							</table>				  


				  </div>
				  <div class="chart-notes">
					fonte: 
				  </div>
				</div>
			  </div>
			  <div class="row">

			  </div>

			</div><!--row end-->

			<div class="row">
			  <div class="col-sm-12">
				<div class="title_sec" style="background-color:#899296;  margin-bottom: 20px;">
					<h1 style="padding-top: 10px;">Indicador Global de Inovação</h1>
					<h2 style="color: white;">posição e score dos países</h2>
				</div>
			  </div>
			</div>				
			<div class="row">
			  <div class="col-sm-12">
				<div class="chart-wrapper">
				  <div class="chart-title" id="correlatos">
					Índice global ao redor do mundo
				  </div>
				  <div class="chart-stage" id ="char-relatstage4">
					<div id="chart27"></div>
				  </div>
				  <div class="chart-notes">
					<p>Dados extraidos do<a href="https://www.globalinnovationindex.org"> The Global Inovation Index</a>.</p>
				  </div>
				</div>
			  </div>		  

			</div>
			
			<div class="row">
				<div class="col-sm-6">
					<div class="chart-wrapper">
					  <div class="chart-title" id="comparativotitle">
						Índice por cooperação Universidade/Industria
					  </div>
					  <div class="chart-stage">
						  <div id="chart28"></div>
					  </div>
					  <div class="chart-notes">
					  
							<p>Dados extraidos do<a href="https://www.globalinnovationindex.org"> The Global Inovation Index</a>.</p>
					  </div>
					
				  </div>
			    </div>
								<div class="col-sm-6">
					<div class="chart-wrapper">
					  <div class="chart-title" id="comparativotitle">
						Índice por nº de patentes solicitadas
					  </div>
					  <div class="chart-stage">
						  <div id="chart29"></div>
					  </div>
					  <div class="chart-notes">
							<p>Dados extraidos do<a href="https://www.globalinnovationindex.org"> The Global Inovation Index</a>.</p>
					  </div>
					
				  </div>
			    </div>
			</div>

	  
		</div>		

		
		
		<div class="col-sm-2">

				<div class="sidebar">						
					<div class="search_widget">
						<input id="sr_bx" type="text" placeholder="Procure nessa categoria...."/>
					</div>				
					<div class="widget">
						<h2>Ciência e Tencnologia</h2>
						<div class="title_br"></div>
						<ul>
							<li><a href="">Inovação</a></li>
							<li><a href="">Pesquisa</a></li>
							<li><a href="">Investimento Privado</a></li>
							<li><a href="">Investimento governamental</a></li>
							<li><a href="">Universidades</a></li>
							<li><a href="">Cooperação Internacional</a></li>
						</ul>
					</div>					

					<div class="widget">
						<h2>palavras-chaves</h2>
						<div class="title_br"></div>
						<ul class="tag">
							<li><a href="">doutorado</a></li>
							<li><a href="">cooperação</a></li>
							<li><a href="">investimento</a></li>
							<li><a href="">nanotecnologia</a></li>
							<li><a href="">TIC</a></li>

						</ul>
					</div>						
				</div>
		
		
		</div>
    </div>

    <hr>

    <p class="small text-muted">Extraido e elaborado por <a href="https://foo-embrasilia.rhcloud.com">AVEC ciencia de dados</a></p>

  </div>
 </div>  <!--fim div content-->
   <script src="{% static 'js/angular.min.js' %}"></script>
 <script>
   var app = angular
      .module('app', [
        // 'ngResource',
        // 'ngRoute',
        // 'ngSanitize',
        // 'ngTouch'
      ]);

    app.controller('treemapCtrl', ['$scope', function($scope) {

      var yrToSrc = {'2016' : "{% static 'data/flare.json' %}",
                     '2015' : "{% static 'data/data2013.json' %}"};

      $scope.year = '2016';
      $scope.dataUrl = yrToSrc[$scope.year];

      // Watch for changes to year, update the dataUrl.
      $scope.$watch('year', function() {
        $scope.dataUrl = yrToSrc[$scope.year];
      });

    }]);

    app.directive('treemap', function () {

      return {
        template: '<div></div>',
        restrict: 'E',
        link: function postLink(scope, element, attrs) {

          clearTreeMap();

          if(angular.isDefined(scope.dataUrl)) {
              drawTreeMap(scope.dataUrl);
          }
          
          scope.$watch('dataUrl', function(newVal, oldVal) {
            console.log("Inside watch! dataUrl newVal: ", newVal, " oldVal: ", oldVal);

            if(angular.isDefined(newVal) && newVal !== oldVal) {
              console.log("Redrawing tree map!");
              clearTreeMap();
              drawTreeMap(newVal);
            }

          });

          function clearTreeMap() {
            element.html("");
          }

          function drawTreeMap(dataUrl) {

            if(!angular.isDefined(dataUrl)) { return; }

			var treemapboxSize =  document.getElementById('treemapbox').offsetWidth;
			
            var margin = {top: 20, right: 0, bottom: 0, left: 0},
                width = treemapboxSize,
                height = 500 - margin.top - margin.bottom,
                formatNumber = d3.format(",d"),
                transitioning;

            var x = d3.scale.linear()
                .domain([0, width])
                .range([0, width]);

            var y = d3.scale.linear()
                .domain([0, height])
                .range([0, height]);

            var color = d3.scale.linear().range(["#eff3ff","#c6dbef","#9ecae1","#6baed6","#3182bd","#08519c"]).domain([0,height*10])

            var treemap = d3.layout.treemap()
                .children(function(d, depth) { return depth ? null : d._children; })
                .sort(function(a, b) { return a.value - b.value; })
                .ratio(height / width * 0.5 * (1 + Math.sqrt(5)))
                .round(false);


            // Manipulate the dom!
            var svg = d3.select(element[0]).append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.bottom + margin.top)
                .style("margin-left", -margin.left + "px")
                .style("margin.right", -margin.right + "px")
              .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
                .style("shape-rendering", "crispEdges");

            var grandparent = svg.append("g")
                .attr("class", "grandparent");


            grandparent.append("rect")
                .attr("y", -margin.top)
                .attr("width", width)
                .attr("height", margin.top * 1.45);

            grandparent.append("text")
                .attr("x", 6)
                .attr("y", 6 - margin.top)
                .attr("dy", "1em");


            d3.json(dataUrl, function(root) {

              initialize(root);
              accumulate(root);
              layout(root);
              display(root);
              
              function initialize(root) {
                root.x = root.y = 0;
                root.dx = width;
                root.dy = height;
                root.depth = 0;
              }
              console.log(root)

              // Aggregate the values for internal nodes. This is normally done by the
              // treemap layout, but not here because of our custom implementation.
              // We also take a snapshot of the original children (_children) to avoid
              // the children being overwritten when when layout is computed.
              function accumulate(d) {
                return (d._children = d.children)
                    ? d.value = d.children.reduce(function(p, v) { return p + accumulate(v); }, 0)
                    : d.value;
              }

              // Compute the treemap layout recursively such that each group of siblings
              // uses the same size (1×1) rather than the dimensions of the parent cell.
              // This optimizes the layout for the current zoom state. Note that a wrapper
              // object is created for the parent node for each group of siblings so that
              // the parent’s dimensions are not discarded as we recurse. Since each group
              // of sibling was laid out in 1×1, we must rescale to fit using absolute
              // coordinates. This lets us use a viewport to zoom.
              function layout(d) {
                if (d._children) {
                  treemap.nodes({_children: d._children});
                  d._children.forEach(function(c) {
                    c.x = d.x + c.x * d.dx;
                    c.y = d.y + c.y * d.dy;
                    c.dx *= d.dx;
                    c.dy *= d.dy;
                    c.parent = d;
                    layout(c);
                  });
                }
              }
			  
			/*##############################*/	
			
			  function fontSize(d,i) {			
				var size = d.dx/12;
				var words = d.name;
				var word = words[0];
				var width = d.dx*.65;
				var height = d.dy;
				var length = 0;
				if (size < 12) {
					d3.select(this).style("font-size", 12 + "px").text(word);
				}else{				    
					d3.select(this).style("font-size", size + "px").text(word);
				}
				while(((this.getBBox().width >= width) || (this.getBBox().height >= height)) && (size > 12))
				 {
				  size--;
				  d3.select(this).style("font-size", size + "px");
				  this.firstChild.data = word;
				 }
				}			
				
				
				function wordWrap(d, i){
					var 	words = d.name.split(' ');	
					//console.log(d);
					var line = new Array();					
					var length = 0;
					var text = "";
					var width = d.dx*.65;
					var height = d.dy;
					var valor = d.value;
					var word;
					do {
					   word = words.shift();					   
					   line.push(word);
					   if (words.length){
						 this.firstChild.data = line.join(' ') + " " + words[0]; 
						 
						 }
					     else{
					     
							this.firstChild.data = line.join(' ');
						 
						 } 
					   
					   length = this.getBBox().width;
					   
					   if (length < width && words.length) {
						 ;						 
					   }
					   else {

						 text = line.join(' ');								 
						 this.firstChild.data = text;						 
						 if (this.getBBox().width > width) {						   
						   text = d3.select(this).select(function() {return this.lastChild;}).text();
						   console.log(text + "- " + this.getBBox().width + " " + width + "  "+ d3.select(this).select(function() {return this.lastChild;}).text());
						   if (width > 6 ){						    
							text = text + "...";							   
						   }else{
						    
							text = "";
						   }						   
						   d3.select(this).select(function() {return this.lastChild;}).text(text);
						   d3.select(this).classed("wordwrapped", true);
						   break;
						};
										
						}
					  } while (words.length);
					  if (text != ""){
						this.firstChild.data = text +" - " +valor;
						}

					} 

				
			/*##############################*/	
              function display(d) {

                grandparent
                    .datum(d.parent)
                    .on("click", transition)
                  .select("text")
                    .text(name(d));

                var g1 = svg.insert("g", ".grandparent")
                    .datum(d)
                    .attr("class", "depth");

                var g = g1.selectAll("g")
                    .data(d._children)
                  .enter().append("g");

                g.filter(function(d) { return d._children; })
                    .classed("children", true)
                    .on("click", transition);

                g.selectAll(".child")
                    .data(function(d) { return d._children || [d]; })
                  .enter().append("rect")
                    .attr("class", "child")
                    .style("fill", function(d) { return color(d.value ); })
                    .call(rect);

                g.append("rect")
                    .attr("class", "parent")
                    .call(rect)
                  .append("title")
                    .text(function(d) { return d.name + " - "+ formatNumber(d.value); })

                g.append("text")
                    .attr("dy", "1.25em")
                    .text(function(d) { return d.name })					
				.each(fontSize)
				//.each(wordWrap)
                    .call(text);
				
	
					

                function transition(d) {

                  if (transitioning || !d) return;
                  transitioning = true;

                  var g2 = display(d),
                      t1 = g1.transition().duration(750),
                      t2 = g2.transition().duration(750);

                  // Update the domain only after entering new elements.
                  x.domain([d.x, d.x + d.dx]);
                  y.domain([d.y, d.y + d.dy]);

                  // Enable anti-aliasing during the transition.
                  svg.style("shape-rendering", null);

                  // Draw child nodes on top of parent nodes.
                  svg.selectAll(".depth").sort(function(a, b) { return a.depth - b.depth; });

                  // Fade-in entering text.
                  g2.selectAll("text").style("fill-opacity", 0);

                  // Transition to the new view.
                  t1.selectAll("text").call(text).style("fill-opacity", 0);
                  t2.selectAll("text").call(text).style("fill-opacity", 1);
                  t1.selectAll("rect").call(rect);
                  t2.selectAll("rect").call(rect);

                  // Remove the old node when the transition is finished.
                  t1.remove().each("end", function() {
                    svg.style("shape-rendering", "crispEdges");
                    transitioning = false;
                  });
                }

                return g;
              }

              function text(text) {
                text.attr("x", function(d) { return x(d.x) + 6; })
                    .attr("y", function(d) { return y(d.y) + 6; })
					.each(fontSize)
					.each(wordWrap);
              }

              function rect(rect) {
                rect.attr("x", function(d) { return x(d.x); })
					.attr("id","rect")
                    .attr("y", function(d) { return y(d.y); })
                    .attr("width", function(d) { return x(d.x + d.dx) - x(d.x); })
                    .attr("height", function(d) { return y(d.y + d.dy) - y(d.y); });
              }

              function name(d) {
                return d.parent
                    ? name(d.parent) + " - " + d.name
                    : d.name;
              }

            }); // end d3.json()

          }
            

        },
        replace: true
      };
    });
 
 </script>
  
  <script type="text/javascript"src="{% static 'js/dashboards/inovacao.js' %}"></script>
  
  

  <script type="text/javascript" src="{% static 'js/bootstrap.min.js' %}"></script>

  <script type="text/javascript" src="{% static 'js/holder.js' %}"></script>
  <script>
    Holder.add_theme("white", { background:"#fff", foreground:"#a7a7a7", size:10 });
  </script>

  <script type="text/javascript" src="{% static 'js/keen.min.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/meta.js' %}"></script>
 
  </body>
</html>
{% endblock %}